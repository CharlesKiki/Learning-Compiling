# 这是什么？
Boot Sector，引导扇区，这是一块大小为512的由MASM编写的汇编程序。使用Linux下的DD命令可以由二进制代码制作为img映像，由此得到系统的引导镜像。

介绍：
PC机的初始化过程会从一种介质中读取一定长度内容作为引导程序，然而当PC开始以软盘的内容为读取内容时，实际上已经有了BIOS这样的软件参与。
软盘的内容作为计算机最初的系统，目的是初始化一些硬件内容，并且为后续的读取内容到内存做准备。

## 背景知识：

PC的启动过程

1.运行内置在BIOS芯片中的加电自检程序，这类程序和电路元器件特性息息相关。

2.按照CMOS中对硬件的配置初始化硬件，CMOS类似存储器设备。

3.按CMOS中存储的启动项顺序搜索启动盘，启动的介质有U盘和软盘。

4.若该启动盘的第一个扇区最后是以0xaa55结尾，则为引导扇区，**CPU将其**512个字节加载到，内存地址0000：7c00处，然后跳转到0x7c00处开始执行引导扇区的代码。

总结：操作系统的加载最初由纯粹的硬件和硬件自建程序引导。系统开发时需要遵守硬件约定。

**后续加载**
通过引导扇区将其加载入内存，然后将控制权交给他，这样就不受512个字节的限制了。

思考：在引导程序接着开始从外部存储设备读入内容到主存前，也就是硬件自检检测引导过程，是不存在权限的，至少程序的权限随着代码的执行顺序变化。因此没有中断，多任务这些概念。而之后加载的操作系统则全权控制了硬件，在操作系统之上构建的应用程序的敏感硬件操作都会移交权限给底层代码。

### 软盘作为存储设备是如何初始化的？###

实现这一方法的代码级实现就是对按顺序写入特定的数据在软盘的开头扇区。虽然他们被被汇编程序写为数据在开头，但是CPU会视为指令，故前面以jmp跳走，这是只读数据。
;BPB数据结构 BIOS Paramter Block

``` mipsasm
;处理器从该数据结构中可以了解软盘格式信息。
	BS_OEMName		DB 'ForrestY'	; OEM String, 必须 8 个字节
	BPB_BytsPerSec	DW 512			; 每扇区字节数
	BPB_SecPerClus	DB 1			; 每簇多少扇区
	BPB_RsvdSecCnt	DW 1			; Boot 记录占用多少扇区
	BPB_NumFATs		DB 2			; 共有多少 FAT 表
	BPB_RootEntCnt	DW 224			; 根目录文件数最大值
	BPB_TotSec16	DW 2880			; 逻辑扇区总数
	BPB_Media		DB 0xF0			; 媒体描述符
	BPB_FATSz16		DW 9			; 每FAT扇区数
	BPB_SecPerTrk	DW 18			; 每磁道扇区数
	BPB_NumHeads	DW 2			; 磁头数(面数)
	BPB_HiddSec		DD 0			; 隐藏扇区数
	BPB_TotSec32	DD 0			; 如果 wTotalSectorCount 是 0 由这个值记录扇区数
	BS_DrvNum		DB 0			; 中断 13 的驱动器号
	BS_Reserved1	DB 0			; 未使用
	BS_BootSig		DB 29h			; 扩展引导标记 (29h)
	BS_VolID		DD 0			; 卷序列号
	BS_VolLab		DB 'OrangeS0.02'; 卷标, 必须 11 个字节
	BS_FileSysType	DB 'FAT12  	    ; 文件系统类型, 必须 8个字节  
```

FAT12是DOS时代就开始使用的文件系统(File System)，直到现在仍然在软盘上使用，FAT12软盘的被格式化后为：有两个磁头，每个磁头80个柱面（磁道），每个柱面有18个扇区，每个扇区512个字节空间。所以标准软盘的总空间为：

2 * 80 *18 * 512=1474560B=1440K=1.44M



### 关于保护模式和CPU ###


### 关于第一个扇区的解释

cpu把扇区当中的数据当作指令来执行，当读取到EB 58 这个指令时，就跳转到0x58这个地址并继续读取指令来执行，而0x58地址之后的内容通常都是载入操作系统的指令。